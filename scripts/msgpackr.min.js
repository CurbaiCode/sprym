(function(m,rr){typeof exports=="object"&&typeof module!="undefined"?rr(exports):typeof define=="function"&&define.amd?define(["exports"],rr):(m=typeof globalThis!="undefined"?globalThis:m||self,rr(m.msgpackr={}))})(this,function(m){"use strict";var rr;try{rr=new TextDecoder}catch(r){}var v,$,n=0,E={},S,G,q=0,Z=0,M,z,N=[],y,Cr={useRecords:!1,mapsAsObjects:!0};class Fr{}var Ur=new Fr;Ur.name="MessagePack 0xC1";var H=!1,Vr=2,Lr;try{new Function("")}catch(r){Vr=1/0}class Q{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(v)return Qr(function(){return lr(),this?this.unpack(e,t):Q.prototype.unpack.call(Cr,e,t)});!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer!="undefined"?Buffer.from(e):new Uint8Array(e)),typeof t=="object"?($=t.end||e.length,n=t.start||0):(n=0,$=t>-1?t:e.length),Z=0,G=null,M=null,v=e;try{y=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(a){throw v=null,e instanceof Uint8Array?a:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Q){if(E=this,this.structures)return S=this.structures,xr(t);(!S||S.length>0)&&(S=[])}else E=Cr,(!S||S.length>0)&&(S=[]);return xr(t)}unpackMultiple(e,t){var a,f=0;try{H=!0;var u=e.length,x=this?this.unpack(e,u):hr.unpack(e,u);if(t){if(t(x,f,n)===!1)return;for(;n<u;)if(f=n,t(xr(),f,n)===!1)return}else{for(a=[x];n<u;)f=n,a.push(xr());return a}}catch(h){throw h.lastPosition=f,h.values=a,h}finally{H=!1,lr()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(function(w){return w.slice(0)}));for(var a=0,f=e.length;a<f;a++){var u=e[a];u&&(u.isShared=!0,a>=32&&(u.highByte=a-32>>5))}e.sharedLength=e.length;for(var x in t||[])if(x>=0){var u=e[x],h=t[x];h&&(u&&((e.restoreStructures||(e.restoreStructures=[]))[x]=u),e[x]=h)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function xr(r){try{if(!E.trusted&&!H){var e=S.sharedLength||0;e<S.length&&(S.length=e)}var t;if(E.randomAccessStructure&&v[n]<64&&v[n]>=32&&Lr?(t=Lr(v,n,$,E),v=null,!(r&&r.lazy)&&t&&(t=t.toJSON()),n=$):t=B(),M&&(n=M.postBundlePosition,M=null),H&&(S.restoreStructures=null),n==$)S&&S.restoreStructures&&Pr(),S=null,v=null,z&&(z=null);else{if(n>$)throw new Error("Unexpected end of MessagePack data");if(!H){var a;try{a=JSON.stringify(t,function(f,u){return typeof u=="bigint"?`${u}n`:u}).slice(0,100)}catch(f){a="(JSON view not available "+f+")"}throw new Error("Data read, but end of buffer not reached "+a)}}return t}catch(f){throw S&&S.restoreStructures&&Pr(),lr(),(f instanceof RangeError||f.message.startsWith("Unexpected end of buffer")||n>$)&&(f.incomplete=!0),f}}function Pr(){for(var r in S.restoreStructures)S[r]=S.restoreStructures[r];S.restoreStructures=null}function B(){var r=v[n++];if(r<160)if(r<128){if(r<64)return r;var e=S[r&63]||E.getStructures&&jr()[r&63];return e?(e.read||(e.read=Ar(e,r&63)),e.read()):r}else if(r<144)if(r-=128,E.mapsAsObjects){for(var t={},a=0;a<r;a++){var f=zr();f==="__proto__"&&(f="__proto_"),t[f]=B()}return t}else{for(var u=new Map,a=0;a<r;a++)u.set(B(),B());return u}else{r-=144;for(var x=new Array(r),a=0;a<r;a++)x[a]=B();return E.freezeData?Object.freeze(x):x}else if(r<192){var h=r-160;if(Z>=n)return G.slice(n-q,(n+=h)-q);if(Z==0&&$<140){var w=h<16?Or(h):Kr(h);if(w!=null)return w}return Ir(h)}else{var o;switch(r){case 192:return null;case 193:return M?(o=B(),o>0?M[1].slice(M.position1,M.position1+=o):M[0].slice(M.position0,M.position0-=o)):Ur;case 194:return!1;case 195:return!0;case 196:if(o=v[n++],o===void 0)throw new Error("Unexpected end of buffer");return kr(o);case 197:return o=y.getUint16(n),n+=2,kr(o);case 198:return o=y.getUint32(n),n+=4,kr(o);case 199:return er(v[n++]);case 200:return o=y.getUint16(n),n+=2,er(o);case 201:return o=y.getUint32(n),n+=4,er(o);case 202:if(o=y.getFloat32(n),E.useFloat32>2){var O=vr[(v[n]&127)<<1|v[n+1]>>7];return n+=4,(O*o+(o>0?.5:-.5)>>0)/O}return n+=4,o;case 203:return o=y.getFloat64(n),n+=8,o;case 204:return v[n++];case 205:return o=y.getUint16(n),n+=2,o;case 206:return o=y.getUint32(n),n+=4,o;case 207:return E.int64AsType==="number"?(o=y.getUint32(n)*4294967296,o+=y.getUint32(n+4)):E.int64AsType==="string"?o=y.getBigUint64(n).toString():E.int64AsType==="auto"?(o=y.getBigUint64(n),o<=BigInt(2)<<BigInt(52)&&(o=Number(o))):o=y.getBigUint64(n),n+=8,o;case 208:return y.getInt8(n++);case 209:return o=y.getInt16(n),n+=2,o;case 210:return o=y.getInt32(n),n+=4,o;case 211:return E.int64AsType==="number"?(o=y.getInt32(n)*4294967296,o+=y.getUint32(n+4)):E.int64AsType==="string"?o=y.getBigInt64(n).toString():E.int64AsType==="auto"?(o=y.getBigInt64(n),o>=BigInt(-2)<<BigInt(52)&&o<=BigInt(2)<<BigInt(52)&&(o=Number(o))):o=y.getBigInt64(n),n+=8,o;case 212:if(o=v[n++],o==114)return Gr(v[n++]&63);var k=N[o];if(k)return k.read?(n++,k.read(B())):k.noBuffer?(n++,k()):k(v.subarray(n,++n));throw new Error("Unknown extension "+o);case 213:return o=v[n],o==114?(n++,Gr(v[n++]&63,v[n++])):er(2);case 214:return er(4);case 215:return er(8);case 216:return er(16);case 217:return o=v[n++],Z>=n?G.slice(n-q,(n+=o)-q):Se(o);case 218:return o=y.getUint16(n),n+=2,Z>=n?G.slice(n-q,(n+=o)-q):me(o);case 219:return o=y.getUint32(n),n+=4,Z>=n?G.slice(n-q,(n+=o)-q):be(o);case 220:return o=y.getUint16(n),n+=2,$r(o);case 221:return o=y.getUint32(n),n+=4,$r(o);case 222:return o=y.getUint16(n),n+=2,qr(o);case 223:return o=y.getUint32(n),n+=4,qr(o);default:if(r>=224)return r-256;if(r===void 0){var P=new Error("Unexpected end of MessagePack data");throw P.incomplete=!0,P}throw new Error("Unknown MessagePack token "+r)}}}var pe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Ar(r,e){function t(){if(a.count++>Vr){var a=r.read=new Function("r","return function(){return "+(E.freezeData?"Object.freeze":"")+"({"+r.map(function(w){return w==="__proto__"?"__proto_:r()":pe.test(w)?w+":r()":"["+JSON.stringify(w)+"]:r()"}).join(",")+"})}")(B);return r.highByte===0&&(r.read=Jr(e,r.read)),a()}for(var f={},u=0,x=r.length;u<x;u++){var h=r[u];h==="__proto__"&&(h="__proto_"),f[h]=B()}return E.freezeData?Object.freeze(f):f}return t.count=0,r.highByte===0?Jr(e,t):t}var Jr=function(r,e){return function(){var t=v[n++];if(t===0)return e();var a=r<32?-(r+(t<<5)):r+(t<<5),f=S[a]||jr()[a];if(!f)throw new Error("Record id is not defined for "+a);return f.read||(f.read=Ar(f,r)),f.read()}};function jr(){var r=Qr(function(){return v=null,E.getStructures()});return S=E._mergeStructures(r,S)}var Ir=ar,Se=ar,me=ar,be=ar,Ee=!1;function ar(r){var e;if(r<16&&(e=Or(r)))return e;if(r>64&&rr)return rr.decode(v.subarray(n,n+=r));var t=n+r,a=[];for(e="";n<t;){var f=v[n++];if(!(f&128))a.push(f);else if((f&224)===192){var u=v[n++]&63;a.push((f&31)<<6|u)}else if((f&240)===224){var u=v[n++]&63,x=v[n++]&63;a.push((f&31)<<12|u<<6|x)}else if((f&248)===240){var u=v[n++]&63,x=v[n++]&63,h=v[n++]&63,w=(f&7)<<18|u<<12|x<<6|h;w>65535&&(w-=65536,a.push(w>>>10&1023|55296),w=56320|w&1023),a.push(w)}else a.push(f);a.length>=4096&&(e+=T.apply(String,a),a.length=0)}return a.length>0&&(e+=T.apply(String,a)),e}function $r(r){for(var e=new Array(r),t=0;t<r;t++)e[t]=B();return E.freezeData?Object.freeze(e):e}function qr(r){if(E.mapsAsObjects){for(var e={},t=0;t<r;t++){var a=zr();a==="__proto__"&&(a="__proto_"),e[a]=B()}return e}else{for(var f=new Map,t=0;t<r;t++)f.set(B(),B());return f}}var T=String.fromCharCode;function Kr(r){for(var e=n,t=new Array(r),a=0;a<r;a++){var f=v[n++];if((f&128)>0){n=e;return}t[a]=f}return T.apply(String,t)}function Or(r){if(r<4)if(r<2){if(r===0)return"";var e=v[n++];if((e&128)>1){n-=1;return}return T(e)}else{var e=v[n++],t=v[n++];if((e&128)>0||(t&128)>0){n-=2;return}if(r<3)return T(e,t);var a=v[n++];if((a&128)>0){n-=3;return}return T(e,t,a)}else{var e=v[n++],t=v[n++],a=v[n++],f=v[n++];if((e&128)>0||(t&128)>0||(a&128)>0||(f&128)>0){n-=4;return}if(r<6){if(r===4)return T(e,t,a,f);var u=v[n++];if((u&128)>0){n-=5;return}return T(e,t,a,f,u)}else if(r<8){var u=v[n++],x=v[n++];if((u&128)>0||(x&128)>0){n-=6;return}if(r<7)return T(e,t,a,f,u,x);var h=v[n++];if((h&128)>0){n-=7;return}return T(e,t,a,f,u,x,h)}else{var u=v[n++],x=v[n++],h=v[n++],w=v[n++];if((u&128)>0||(x&128)>0||(h&128)>0||(w&128)>0){n-=8;return}if(r<10){if(r===8)return T(e,t,a,f,u,x,h,w);var o=v[n++];if((o&128)>0){n-=9;return}return T(e,t,a,f,u,x,h,w,o)}else if(r<12){var o=v[n++],O=v[n++];if((o&128)>0||(O&128)>0){n-=10;return}if(r<11)return T(e,t,a,f,u,x,h,w,o,O);var k=v[n++];if((k&128)>0){n-=11;return}return T(e,t,a,f,u,x,h,w,o,O,k)}else{var o=v[n++],O=v[n++],k=v[n++],P=v[n++];if((o&128)>0||(O&128)>0||(k&128)>0||(P&128)>0){n-=12;return}if(r<14){if(r===12)return T(e,t,a,f,u,x,h,w,o,O,k,P);var j=v[n++];if((j&128)>0){n-=13;return}return T(e,t,a,f,u,x,h,w,o,O,k,P,j)}else{var j=v[n++],X=v[n++];if((j&128)>0||(X&128)>0){n-=14;return}if(r<15)return T(e,t,a,f,u,x,h,w,o,O,k,P,j,X);var K=v[n++];if((K&128)>0){n-=15;return}return T(e,t,a,f,u,x,h,w,o,O,k,P,j,X,K)}}}}}function Yr(){var r=v[n++],e;if(r<192)e=r-160;else switch(r){case 217:e=v[n++];break;case 218:e=y.getUint16(n),n+=2;break;case 219:e=y.getUint32(n),n+=4;break;default:throw new Error("Expected string")}return ar(e)}function kr(r){return E.copyBuffers?Uint8Array.prototype.slice.call(v,n,n+=r):v.subarray(n,n+=r)}function er(r){var e=v[n++];if(N[e]){var t;return N[e](v.subarray(n,t=n+=r),function(a){n=a;try{return B()}finally{n=t}})}else throw new Error("Unknown extension type "+e)}var Zr=new Array(4096);function zr(){var r=v[n++];if(r>=160&&r<192){if(r=r-160,Z>=n)return G.slice(n-q,(n+=r)-q);if(!(Z==0&&$<180))return Ir(r)}else return n--,Xr(B());var e=(r<<5^(r>1?y.getUint16(n):r>0?v[n]:0))&4095,t=Zr[e],a=n,f=n+r-3,u,x=0;if(t&&t.bytes==r){for(;a<f;){if(u=y.getUint32(a),u!=t[x++]){a=1879048192;break}a+=4}for(f+=3;a<f;)if(u=v[a++],u!=t[x++]){a=1879048192;break}if(a===f)return n=a,t.string;f-=3,a=n}for(t=[],Zr[e]=t,t.bytes=r;a<f;)u=y.getUint32(a),t.push(u),a+=4;for(f+=3;a<f;)u=v[a++],t.push(u);var h=r<16?Or(r):Kr(r);return h!=null?t.string=h:t.string=Ir(r)}function Xr(r){if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean"||typeof r=="bigint")return r.toString();if(r==null)return r+"";throw new Error("Invalid property type for record",typeof r)}var Gr=function(r,e){var t=B().map(Xr),a=r;e!==void 0&&(r=r<32?-((e<<5)+r):(e<<5)+r,t.highByte=e);var f=S[r];return f&&(f.isShared||H)&&((S.restoreStructures||(S.restoreStructures=[]))[r]=f),S[r]=t,t.read=Ar(t,a),t.read()};N[0]=function(){},N[0].noBuffer=!0,N[66]=function(r){for(var e=r.length,t=BigInt(r[0]&128?r[0]-256:r[0]),a=1;a<e;a++)t<<=BigInt(8),t+=BigInt(r[a]);return t};var Ue={Error,TypeError,ReferenceError};N[101]=function(){var r=B();return(Ue[r[0]]||Error)(r[1],{cause:r[2]})},N[105]=function(r){if(E.structuredClone===!1)throw new Error("Structured clone extension is disabled");var e=y.getUint32(n-4);z||(z=new Map);var t=v[n],a;t>=144&&t<160||t==220||t==221?a=[]:a={};var f={target:a};z.set(e,f);var u=B();return f.used?Object.assign(a,u):(f.target=u,u)},N[112]=function(r){if(E.structuredClone===!1)throw new Error("Structured clone extension is disabled");var e=y.getUint32(n-4),t=z.get(e);return t.used=!0,t.target},N[115]=function(){new Set(B())};var Hr=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(function(r){return r+"Array"}),Ae=typeof globalThis=="object"?globalThis:window;N[116]=function(r){var e=r[0],t=Hr[e];if(!t){if(e===16){var a=new ArrayBuffer(r.length-1),f=new Uint8Array(a);return f.set(r.subarray(1)),a}throw new Error("Could not find typed array for code "+e)}return new Ae[t](Uint8Array.prototype.slice.call(r,1).buffer)},N[120]=function(){var r=B();return new RegExp(r[0],r[1])};var Ie=[];N[98]=function(r){var e=(r[0]<<24)+(r[1]<<16)+(r[2]<<8)+r[3],t=n;return n+=e-r.length,M=Ie,M=[Yr(),Yr()],M.position0=0,M.position1=0,M.postBundlePosition=n,n=t,B()},N[255]=function(r){return r.length==4?new Date((r[0]*16777216+(r[1]<<16)+(r[2]<<8)+r[3])*1e3):r.length==8?new Date(((r[0]<<22)+(r[1]<<14)+(r[2]<<6)+(r[3]>>2))/1e6+((r[3]&3)*4294967296+r[4]*16777216+(r[5]<<16)+(r[6]<<8)+r[7])*1e3):r.length==12?new Date(((r[0]<<24)+(r[1]<<16)+(r[2]<<8)+r[3])/1e6+((r[4]&128?-281474976710656:0)+r[6]*1099511627776+r[7]*4294967296+r[8]*16777216+(r[9]<<16)+(r[10]<<8)+r[11])*1e3):new Date("invalid")};function Qr(r){var e=$,t=n,a=q,f=Z,u=G,x=z,h=M,w=new Uint8Array(v.slice(0,$)),o=S,O=S.slice(0,S.length),k=E,P=H,j=r();$=e,n=t,q=a,Z=f,G=u,z=x,M=h,v=w,H=P,S=o;for(var X of O)S.splice(0,S.length,X);return E=k,y=new DataView(v.buffer,v.byteOffset,v.byteLength),j}function lr(){v=null,z=null,S=null}function Oe(r){r.unpack?N[r.type]=r.unpack:N[r.type]=r}for(var vr=new Array(147),dr=0;dr<256;dr++)vr[dr]=+("1e"+Math.floor(45.15-dr*.30103));var ke=Q,hr=new Q({useRecords:!1}),_e=hr.unpack,Be=hr.unpackMultiple,Re=hr.unpack,Wr={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},re=new Float32Array(1),ee=new Uint8Array(re.buffer,0,4);function Me(r){re[0]=r;var e=vr[(ee[3]&127)<<1|ee[2]>>7];return(e*r+(r>0?.5:-.5)>>0)/e}var gr;try{gr=new TextEncoder}catch(r){}var yr,_r,wr=typeof Buffer!="undefined",pr=wr?function(r){return Buffer.allocUnsafeSlow(r)}:Uint8Array,te=wr?Buffer:Uint8Array,ne=wr?4294967296:2144337920,s,sr,U,i=0,L,I=null,Te,De=21760,Ne=/[\u0080-\uFFFF]/,nr=Symbol("record-id");class cr extends Q{constructor(e){super(e),this.offset=0;var t,a,f,u,x=te.prototype.utf8Write?function(c,d){return s.utf8Write(c,d,4294967295)}:gr&&gr.encodeInto?function(c,d){return gr.encodeInto(c,s.subarray(d)).written}:!1,h=this;e||(e={});var w=e&&e.sequential,o=e.structures||e.saveStructures,O=e.maxSharedStructures;if(O==null&&(O=o?32:0),O>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);var k=e.maxOwnStructures;k==null&&(k=o?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);var P=O>32||k+O>64,j=O+64,X=O+k+64;if(X>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");var K=[],Br=0,Sr=0;this.pack=this.encode=function(c,d){if(s||(s=new pr(8192),U=s.dataView||(s.dataView=new DataView(s.buffer,0,8192)),i=0),L=s.length-10,L-i<2048?(s=new pr(s.length),U=s.dataView||(s.dataView=new DataView(s.buffer,0,s.length)),L=s.length-10,i=0):i=i+7&2147483640,t=i,d&oe&&(i+=d&255),u=h.structuredClone?new Map:null,h.bundleStrings&&typeof c!="string"?(I=[],I.size=1/0):I=null,f=h.structures,f){f.uninitialized&&(f=h._mergeStructures(h.getStructures()));var l=f.sharedLength||0;if(l>O)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+f.sharedLength);if(!f.transitions){f.transitions=Object.create(null);for(var g=0;g<l;g++){var p=f[g];if(p){for(var b,J=f.transitions,D=0,C=p.length;D<C;D++){var _=p[D];b=J[_],b||(b=J[_]=Object.create(null)),J=b}J[nr]=g+64}}this.lastNamedStructuresLength=l}w||(f.nextId=l+64)}a&&(a=!1);var A;try{h.randomAccessStructure&&c&&c.constructor&&c.constructor===Object?et(c):R(c);var F=I;if(I&&ae(t,R,0),u&&u.idsToInsert){for(var V=u.idsToInsert.sort(function(Dr,Nr){Dr.offset>Nr.offset}),g=V.length,Y=-1;F&&g>0;){var ur=V[--g].offset+t;ur<F.stringsPosition+t&&Y===-1&&(Y=0),ur>F.position+t?Y>=0&&(Y+=6):(Y>=0&&(U.setUint32(F.position+t,U.getUint32(F.position+t)+Y),Y=-1),F=F.previous,g++)}Y>=0&&F&&U.setUint32(F.position+t,U.getUint32(F.position+t)+Y),i+=V.length*6,i>L&&W(i),h.offset=i;var tr=Fe(s.subarray(t,i),V);return u=null,tr}return h.offset=i,d&ce?(s.start=t,s.end=i,s):s.subarray(t,i)}catch(br){throw A=br,br}finally{if(f&&(xe(),a&&h.saveStructures)){var l=f.sharedLength||0,Tr=s.subarray(t,i),fr=Le(f,h);if(!A)return h.saveStructures(fr,fr.isCompatible)===!1?h.pack(c,d):(h.lastNamedStructuresLength=l,s.length>1073741824&&(s=null),Tr)}s.length>1073741824&&(s=null),d&ue&&(i=t)}};var xe=function(){Sr<10&&Sr++;var c=f.sharedLength||0;if(f.length>c&&!w&&(f.length=c),Br>1e4)f.transitions=null,Sr=0,Br=0,K.length>0&&(K=[]);else if(K.length>0&&!w){for(var d=0,l=K.length;d<l;d++)K[d][nr]=0;K=[]}},Rr=function(c){var d=c.length;d<16?s[i++]=144|d:d<65536?(s[i++]=220,s[i++]=d>>8,s[i++]=d&255):(s[i++]=221,U.setUint32(i,d),i+=4);for(var l=0;l<d;l++)R(c[l])},R=function(c){i>L&&(s=W(i));var d=typeof c,l;if(d==="string"){var g=c.length;if(I&&g>=4&&g<4096){if((I.size+=g)>De){var p,C=(I[0]?I[0].length*3+I[1].length:0)+10;i+C>L&&(s=W(i+C));var b;I.position?(b=I,s[i]=200,i+=3,s[i++]=98,p=i-t,i+=4,ae(t,R,0),U.setUint16(p+t-3,i-t-p)):(s[i++]=214,s[i++]=98,p=i-t,i+=4),I=["",""],I.previous=b,I.size=0,I.position=p}var J=Ne.test(c);I[J?0:1]+=c,s[i++]=193,R(J?-g:g);return}var D;g<32?D=1:g<256?D=2:g<65536?D=3:D=5;var C=g*3;if(i+C>L&&(s=W(i+C)),g<64||!x){var _,A,F,V=i+D;for(_=0;_<g;_++)A=c.charCodeAt(_),A<128?s[V++]=A:A<2048?(s[V++]=A>>6|192,s[V++]=A&63|128):(A&64512)===55296&&((F=c.charCodeAt(_+1))&64512)===56320?(A=65536+((A&1023)<<10)+(F&1023),_++,s[V++]=A>>18|240,s[V++]=A>>12&63|128,s[V++]=A>>6&63|128,s[V++]=A&63|128):(s[V++]=A>>12|224,s[V++]=A>>6&63|128,s[V++]=A&63|128);l=V-i-D}else l=x(c,i+D);l<32?s[i++]=160|l:l<256?(D<2&&s.copyWithin(i+2,i+1,i+1+l),s[i++]=217,s[i++]=l):l<65536?(D<3&&s.copyWithin(i+3,i+2,i+2+l),s[i++]=218,s[i++]=l>>8,s[i++]=l&255):(D<5&&s.copyWithin(i+5,i+3,i+3+l),s[i++]=219,U.setUint32(i,l),i+=4),i+=l}else if(d==="number")if(c>>>0===c)c<32||c<128&&this.useRecords===!1||c<64&&!this.randomAccessStructure?s[i++]=c:c<256?(s[i++]=204,s[i++]=c):c<65536?(s[i++]=205,s[i++]=c>>8,s[i++]=c&255):(s[i++]=206,U.setUint32(i,c),i+=4);else if(c>>0===c)c>=-32?s[i++]=256+c:c>=-128?(s[i++]=208,s[i++]=c+256):c>=-32768?(s[i++]=209,U.setInt16(i,c),i+=2):(s[i++]=210,U.setInt32(i,c),i+=4);else{var Y;if((Y=this.useFloat32)>0&&c<4294967296&&c>=-2147483648){s[i++]=202,U.setFloat32(i,c);var ur;if(Y<4||(ur=c*vr[(s[i]&127)<<1|s[i+1]>>7])>>0===ur){i+=4;return}else i--}s[i++]=203,U.setFloat64(i,c),i+=8}else if(d==="object"||d==="function")if(!c)s[i++]=192;else{if(u){var tr=u.get(c);if(tr){if(!tr.id){var Tr=u.idsToInsert||(u.idsToInsert=[]);tr.id=Tr.push(tr)}s[i++]=214,s[i++]=112,U.setUint32(i,tr.id),i+=4;return}else u.set(c,{offset:i-t})}var fr=c.constructor;if(fr===Object)mr(c);else if(fr===Array)Rr(c);else if(fr===Map)if(this.mapAsEmptyObject)s[i++]=128;else{l=c.size,l<16?s[i++]=128|l:l<65536?(s[i++]=222,s[i++]=l>>8,s[i++]=l&255):(s[i++]=223,U.setUint32(i,l),i+=4);for(var[br,Dr]of c)R(br),R(Dr)}else{for(var _=0,Nr=yr.length;_<Nr;_++){var tt=_r[_];if(c instanceof tt){var ir=yr[_];if(ir.write){ir.type&&(s[i++]=212,s[i++]=ir.type,s[i++]=0);var ge=ir.write.call(this,c);ge===c?Array.isArray(c)?Rr(c):mr(c):R(ge);return}var Er=s,nt=U,ft=i;s=null;var or;try{or=ir.pack.call(this,c,function(we){return s=Er,Er=null,i+=we,i>L&&W(i),{target:s,targetView:U,position:i-we}},R)}finally{Er&&(s=Er,U=nt,i=ft,L=s.length-10)}or&&(or.length+i>L&&W(or.length+i),i=Ce(or,s,i,ir.type));return}}if(Array.isArray(c))Rr(c);else{if(c.toJSON){var ye=c.toJSON();if(ye!==c)return R(ye)}if(d==="function")return R(this.writeFunction&&this.writeFunction(c));mr(c)}}}else if(d==="boolean")s[i++]=c?195:194;else if(d==="bigint"){if(c<BigInt(1)<<BigInt(63)&&c>=-(BigInt(1)<<BigInt(63)))s[i++]=211,U.setBigInt64(i,c);else if(c<BigInt(1)<<BigInt(64)&&c>0)s[i++]=207,U.setBigUint64(i,c);else if(this.largeBigIntToFloat)s[i++]=203,U.setFloat64(i,Number(c));else throw new RangeError(c+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension or set largeBigIntToFloat to convert to float-64");i+=8}else if(d==="undefined")this.encodeUndefinedAsNil?s[i++]=192:(s[i++]=212,s[i++]=0,s[i++]=0);else throw new Error("Unknown type: "+d)},le=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?function(c){var d;if(this.skipValues){d=[];for(var g in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(g))&&!this.skipValues.includes(c[g])&&d.push(g)}else d=Object.keys(c);var l=d.length;l<16?s[i++]=128|l:l<65536?(s[i++]=222,s[i++]=l>>8,s[i++]=l&255):(s[i++]=223,U.setUint32(i,l),i+=4);var g;if(this.coercibleKeyAsNumber)for(var p=0;p<l;p++){g=d[p];var b=Number(g);R(isNaN(b)?g:b),R(c[g])}else for(var p=0;p<l;p++)R(g=d[p]),R(c[g])}:function(c){s[i++]=222;var d=i-t;i+=2;var l=0;for(var g in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(g))&&(R(g),R(c[g]),l++);s[d+++t]=l>>8,s[d+t]=l&255},ve=this.useRecords===!1?le:e.progressiveRecords&&!P?function(c){var d,l=f.transitions||(f.transitions=Object.create(null)),g=i++-t,p;for(var b in c)if(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(b)){if(d=l[b],d)l=d;else{var J=Object.keys(c),D=l;l=f.transitions;for(var C=0,_=0,A=J.length;_<A;_++){var b=J[_];d=l[b],d||(d=l[b]=Object.create(null),C++),l=d}g+t+1==i?(i--,Mr(l,J,C)):he(l,J,g,C),p=!0,l=D[b]}R(c[b])}if(!p){var F=l[nr];F?s[g+t]=F:he(l,Object.keys(c),g,0)}}:function(c){var d,l=f.transitions||(f.transitions=Object.create(null)),g=0;for(var p in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(p))&&(d=l[p],d||(d=l[p]=Object.create(null),g++),l=d);var b=l[nr];b?b>=96&&P?(s[i++]=((b-=96)&31)+96,s[i++]=b>>5):s[i++]=b:Mr(l,l.__keys__||Object.keys(c),g);for(var p in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(p))&&R(c[p])},de=typeof this.useRecords=="function"&&this.useRecords,mr=de?function(c){de(c)?ve(c):le(c)}:ve,W=function(c){var d;if(c>16777216){if(c-t>ne)throw new Error("Packed buffer would be larger than maximum buffer size");d=Math.min(ne,Math.round(Math.max((c-t)*(c>67108864?1.25:2),4194304)/4096)*4096)}else d=(Math.max(c-t<<2,s.length-1)>>12)+1<<12;var l=new pr(d);return U=l.dataView||(l.dataView=new DataView(l.buffer,0,d)),c=Math.min(c,s.length),s.copy?s.copy(l,0,t,c):l.set(s.slice(t,c)),i-=t,t=0,L=l.length-10,s=l},Mr=function(c,d,l){var g=f.nextId;g||(g=64),g<j&&this.shouldShareStructure&&!this.shouldShareStructure(d)?(g=f.nextOwnId,g<X||(g=j),f.nextOwnId=g+1):(g>=X&&(g=j),f.nextId=g+1);var p=d.highByte=g>=96&&P?g-96>>5:-1;c[nr]=g,c.__keys__=d,f[g-64]=d,g<j?(d.isShared=!0,f.sharedLength=g-63,a=!0,p>=0?(s[i++]=(g&31)+96,s[i++]=p):s[i++]=g):(p>=0?(s[i++]=213,s[i++]=114,s[i++]=(g&31)+96,s[i++]=p):(s[i++]=212,s[i++]=114,s[i++]=g),l&&(Br+=Sr*l),K.length>=k&&(K.shift()[nr]=0),K.push(c),R(d))},he=function(c,d,l,g){var p=s,b=i,J=L,D=t;s=sr,i=0,t=0,s||(sr=s=new pr(8192)),L=s.length-10,Mr(c,d,g),sr=s;var C=i;if(s=p,i=b,L=J,t=D,C>1){var _=i+C-1;_>L&&W(_);var A=l+t;s.copyWithin(A+C,A+1,i),s.set(sr.slice(0,C),A),i=_}else s[l+t]=sr[0]},et=function(c){var d=Te(c,s,t,i,f,W,function(l,g,p){if(p)return a=!0;i=g;var b=s;return R(l),xe(),b!==s?{position:i,targetView:U,target:s}:i},this);if(d===0)return mr(c);i=d}}useBuffer(e){s=e,s.dataView||(s.dataView=new DataView(s.buffer,s.byteOffset,s.byteLength)),i=0}set position(e){i=e}get position(){return i}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}_r=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Fr],yr=[{pack(r,e,t){var a=r.getTime()/1e3;if((this.useTimestamp32||r.getMilliseconds()===0)&&a>=0&&a<4294967296){var{target:f,targetView:u,position:x}=e(6);f[x++]=214,f[x++]=255,u.setUint32(x,a)}else if(a>0&&a<4294967296){var{target:f,targetView:u,position:x}=e(10);f[x++]=215,f[x++]=255,u.setUint32(x,r.getMilliseconds()*4e6+(a/1e3/4294967296>>0)),u.setUint32(x+4,a)}else if(isNaN(a)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());var{target:f,targetView:u,position:x}=e(3);f[x++]=212,f[x++]=255,f[x++]=255}else{var{target:f,targetView:u,position:x}=e(15);f[x++]=199,f[x++]=12,f[x++]=255,u.setUint32(x,r.getMilliseconds()*1e6),u.setBigInt64(x+4,BigInt(Math.floor(a)))}}},{pack(r,e,t){if(this.setAsEmptyObject)return e(0),t({});var a=Array.from(r),{target:f,position:u}=e(this.moreTypes?3:0);this.moreTypes&&(f[u++]=212,f[u++]=115,f[u++]=0),t(a)}},{pack(r,e,t){var{target:a,position:f}=e(this.moreTypes?3:0);this.moreTypes&&(a[f++]=212,a[f++]=101,a[f++]=0),t([r.name,r.message,r.cause])}},{pack(r,e,t){var{target:a,position:f}=e(this.moreTypes?3:0);this.moreTypes&&(a[f++]=212,a[f++]=120,a[f++]=0),t([r.source,r.flags])}},{pack(r,e){this.moreTypes?fe(r,16,e):ie(wr?Buffer.from(r):new Uint8Array(r),e)}},{pack(r,e){var t=r.constructor;t!==te&&this.moreTypes?fe(r,Hr.indexOf(t.name),e):ie(r,e)}},{pack(r,e){var{target:t,position:a}=e(1);t[a]=193}}];function fe(r,e,t,a){var f=r.byteLength;if(f+1<256){var{target:u,position:x}=t(4+f);u[x++]=199,u[x++]=f+1}else if(f+1<65536){var{target:u,position:x}=t(5+f);u[x++]=200,u[x++]=f+1>>8,u[x++]=f+1&255}else{var{target:u,position:x,targetView:h}=t(7+f);u[x++]=201,h.setUint32(x,f+1),x+=4}u[x++]=116,u[x++]=e,r.buffer||(r=new Uint8Array(r)),u.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength),x)}function ie(r,e){var t=r.byteLength,a,f;if(t<256){var{target:a,position:f}=e(t+2);a[f++]=196,a[f++]=t}else if(t<65536){var{target:a,position:f}=e(t+3);a[f++]=197,a[f++]=t>>8,a[f++]=t&255}else{var{target:a,position:f,targetView:u}=e(t+5);a[f++]=198,u.setUint32(f,t),f+=4}a.set(r,f)}function Ce(r,e,t,a){var f=r.length;switch(f){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:f<256?(e[t++]=199,e[t++]=f):f<65536?(e[t++]=200,e[t++]=f>>8,e[t++]=f&255):(e[t++]=201,e[t++]=f>>24,e[t++]=f>>16&255,e[t++]=f>>8&255,e[t++]=f&255)}return e[t++]=a,e.set(r,t),t+=f,t}function Fe(r,e){for(var t,a=e.length*6,f=r.length-a;t=e.pop();){var u=t.offset,x=t.id;r.copyWithin(u+a,u,f),a-=6;var h=u+a;r[h++]=214,r[h++]=105,r[h++]=x>>24,r[h++]=x>>16&255,r[h++]=x>>8&255,r[h++]=x&255,f=u}return r}function ae(r,e,t){if(I.length>0){U.setUint32(I.position+r,i+t-I.position-r),I.stringsPosition=i-r;var a=I;I=null,e(a[0]),e(a[1])}}function Ve(r){if(r.Class){if(!r.pack&&!r.write)throw new Error("Extension has no pack or write function");if(r.pack&&!r.type)throw new Error("Extension has no type (numeric code to identify the extension)");_r.unshift(r.Class),yr.unshift(r)}Oe(r)}function Le(r,e){return r.isCompatible=function(t){var a=!t||(e.lastNamedStructuresLength||0)===t.length;return a||e._mergeStructures(t),a},r}var se=new cr({useRecords:!1}),Pe=se.pack,Je=se.pack,je=cr,{NEVER:$e,ALWAYS:qe,DECIMAL_ROUND:Ke,DECIMAL_FIT:Ye}=Wr,ce=512,ue=1024,oe=2048;function Ze(r,e){if(e=e!=null?e:{},!r||typeof r!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof r[Symbol.iterator]=="function")return ze(r,e);if(typeof r.then=="function"||typeof r[Symbol.asyncIterator]=="function")return Xe(r,e);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function ze(r,e){var t=new cr(e),a=objectIteratorSymbol.iterator;return{next:function(){return a.next().then(function(f){return f.done?{done:!0}:t.pack(f.value).then(function(u){return{value:u,done:!1}})})}}}function Xe(r,e){var t=new cr(e),a=objectIteratorSymbol.asyncIterator;return{next:function(){return a.next().then(function(f){return f.done?{done:!0}:t.pack(f.value).then(function(u){return{value:u,done:!1}})})}}}function Ge(r,e){if(e=e!=null?e:{},!r||typeof r!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");var t=new Q(e),a,f=function(u){var x;a&&(u=Buffer.concat([a,u]),a=void 0);try{x=t.unpackMultiple(u)}catch(h){if(h.incomplete)a=u.slice(h.lastPosition),x=h.values;else throw h}return x};if(typeof r[Symbol.iterator]=="function")return function(){var x=symbol.iterator;return{next:function(){return x.next().then(function(h){return h.done?{done:!0}:f(h.value).then(function(w){return{value:w,done:!1}})})}}}();if(typeof r[Symbol.asyncIterator]=="function")return function(){var x=symbol.asyncIterator;return{next:function(){return x.next().then(function(h){return h.done?{done:!0}:f(h.value).then(function(w){return{value:w,done:!1}})})}}}()}var He=Ge,Qe=Ze,We=!1,rt=!0;m.ALWAYS=qe,m.C1=Ur,m.DECIMAL_FIT=Ye,m.DECIMAL_ROUND=Ke,m.Decoder=ke,m.Encoder=je,m.FLOAT32_OPTIONS=Wr,m.NEVER=$e,m.Packr=cr,m.RESERVE_START_SPACE=oe,m.RESET_BUFFER_MODE=ue,m.REUSE_BUFFER_MODE=ce,m.Unpackr=Q,m.addExtension=Ve,m.clearSource=lr,m.decode=Re,m.decodeIter=He,m.encode=Je,m.encodeIter=Qe,m.isNativeAccelerationEnabled=Ee,m.mapsAsObjects=rt,m.pack=Pe,m.roundFloat32=Me,m.unpack=_e,m.unpackMultiple=Be,m.useRecords=We});
